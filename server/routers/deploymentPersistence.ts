/**\n * 部署持久化 tRPC 路由\n * \n * 提供部署日誌、告警和審計日誌的 API 端點。\n */\n\nimport { router, publicProcedure, protectedProcedure } from '../_core/trpc';\nimport { z } from 'zod';\nimport deploymentLogger from '../services/deploymentLogger';\n\nexport const deploymentPersistenceRouter = router({\n  /**\n   * 獲取部署日誌列表\n   */\n  getDeploymentLogs: publicProcedure\n    .input(\n      z.object({\n        type: z.enum(['BinaryMarket', 'CopyTradingVault']).optional(),\n        status: z.enum(['pending', 'processing', 'completed', 'failed']).optional(),\n        limit: z.number().min(1).max(100).default(20),\n        offset: z.number().min(0).default(0),\n      })\n    )\n    .query(async ({ input }) => {\n      return await deploymentLogger.getDeploymentLogs({\n        type: input.type,\n        status: input.status,\n        limit: input.limit,\n        offset: input.offset,\n      });\n    }),\n\n  /**\n   * 獲取部署統計\n   */\n  getDeploymentStats: publicProcedure\n    .input(\n      z.object({\n        type: z.enum(['BinaryMarket', 'CopyTradingVault']).optional(),\n        days: z.number().min(1).max(365).default(7),\n      })\n    )\n    .query(async ({ input }) => {\n      return await deploymentLogger.getDeploymentStats({\n        type: input.type,\n        days: input.days,\n      });\n    }),\n\n  /**\n   * 獲取告警列表\n   */\n  getAlerts: publicProcedure\n    .input(\n      z.object({\n        level: z.enum(['INFO', 'WARNING', 'CRITICAL']).optional(),\n        status: z.enum(['ACTIVE', 'ACKNOWLEDGED', 'RESOLVED']).optional(),\n        source: z.string().optional(),\n        limit: z.number().min(1).max(100).default(20),\n        offset: z.number().min(0).default(0),\n      })\n    )\n    .query(async ({ input }) => {\n      return await deploymentLogger.getAlerts({\n        level: input.level,\n        status: input.status,\n        source: input.source,\n        limit: input.limit,\n        offset: input.offset,\n      });\n    }),\n\n  /**\n   * 獲取活躍告警\n   */\n  getActiveAlerts: publicProcedure\n    .input(\n      z.object({\n        level: z.enum(['INFO', 'WARNING', 'CRITICAL']).optional(),\n        limit: z.number().min(1).max(50).default(10),\n      })\n    )\n    .query(async ({ input }) => {\n      return await deploymentLogger.getActiveAlerts({\n        level: input.level,\n        limit: input.limit,\n      });\n    }),\n\n  /**\n   * 確認告警\n   */\n  acknowledgeAlert: protectedProcedure\n    .input(\n      z.object({\n        alertId: z.string(),\n      })\n    )\n    .mutation(async ({ input, ctx }) => {\n      await deploymentLogger.acknowledgeAlert(input.alertId, ctx.user.id);\n      return { success: true };\n    }),\n\n  /**\n   * 解決告警\n   */\n  resolveAlert: protectedProcedure\n    .input(\n      z.object({\n        alertId: z.string(),\n      })\n    )\n    .mutation(async ({ input, ctx }) => {\n      await deploymentLogger.resolveAlert(input.alertId, ctx.user.id);\n      return { success: true };\n    }),\n\n  /**\n   * 獲取審計日誌\n   */\n  getAuditLogs: protectedProcedure\n    .input(\n      z.object({\n        action: z.string().optional(),\n        resource: z.string().optional(),\n        status: z.enum(['success', 'failure']).optional(),\n        limit: z.number().min(1).max(100).default(20),\n        offset: z.number().min(0).default(0),\n      })\n    )\n    .query(async ({ input, ctx }) => {\n      return await deploymentLogger.getAuditLogs({\n        userId: ctx.user.id,\n        action: input.action,\n        resource: input.resource,\n        status: input.status,\n        limit: input.limit,\n        offset: input.offset,\n      });\n    }),\n});\n

/**\n * 市場數據模型\n * \n * 定義市場、市場事件、市場價格和流動性相關的數據庫表\n */\n\nimport {\n  pgTable,\n  varchar,\n  text,\n  timestamp,\n  numeric,\n  integer,\n  boolean,\n  jsonb,\n  index,\n  foreignKey,\n  uniqueIndex,\n} from 'drizzle-orm/pg-core';\n\n/**\n * 市場表\n * \n * 存儲預測市場的基本信息\n */\nexport const markets = pgTable(\n  'markets',\n  {\n    // 主鍵\n    id: varchar('id', { length: 36 }).primaryKey(), // UUID\n\n    // 基本信息\n    title: varchar('title', { length: 256 }).notNull(),\n    description: text('description'),\n    category: varchar('category', { length: 50 }).notNull(), // 'crypto', 'sports', 'politics', etc.\n    tags: jsonb('tags'), // ['Bitcoin', 'Price', 'Prediction']\n\n    // 合約信息\n    contractAddress: varchar('contract_address', { length: 42 }).notNull().unique(),\n    deploymentTxHash: varchar('deployment_tx_hash', { length: 66 }).notNull(),\n    deploymentBlockNumber: integer('deployment_block_number').notNull(),\n\n    // 市場參數\n    endDate: timestamp('end_date', { withTimezone: true }).notNull(),\n    resolutionDate: timestamp('resolution_date', { withTimezone: true }),\n    oracleAddress: varchar('oracle_address', { length: 42 }).notNull(),\n    initialLiquidity: numeric('initial_liquidity', { precision: 38, scale: 18 }).notNull(), // Wei\n\n    // 市場狀態\n    status: varchar('status', { length: 20 }).notNull().default('active'), // 'active', 'closed', 'resolved', 'cancelled'\n    outcome: varchar('outcome', { length: 50 }), // 'yes', 'no', 'tie', 'cancelled'\n    outcomeProof: text('outcome_proof'), // Oracle 提供的證明\n\n    // 交易統計\n    totalVolume: numeric('total_volume', { precision: 38, scale: 18 }).default('0'), // Wei\n    totalTrades: integer('total_trades').default(0),\n    uniqueTraders: integer('unique_traders').default(0),\n    openInterest: numeric('open_interest', { precision: 38, scale: 18 }).default('0'), // Wei\n\n    // 流動性信息\n    currentLiquidity: numeric('current_liquidity', { precision: 38, scale: 18 }).notNull(), // Wei\n    yesPrice: numeric('yes_price', { precision: 10, scale: 8 }).default('0.5'), // 0-1\n    noPrice: numeric('no_price', { precision: 10, scale: 8 }).default('0.5'), // 0-1\n\n    // 費用信息\n    makerFee: numeric('maker_fee', { precision: 10, scale: 8 }).default('0.002'), // 0.2%\n    takerFee: numeric('taker_fee', { precision: 10, scale: 8 }).default('0.005'), // 0.5%\n\n    // 創建者信息\n    creatorAddress: varchar('creator_address', { length: 42 }).notNull(),\n    creatorFeePercentage: numeric('creator_fee_percentage', { precision: 10, scale: 8 }).default('0.01'), // 1%\n\n    // 時間戳\n    createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),\n    updatedAt: timestamp('updated_at', { withTimezone: true }).notNull().defaultNow(),\n    closedAt: timestamp('closed_at', { withTimezone: true }),\n    resolvedAt: timestamp('resolved_at', { withTimezone: true }),\n  },\n  (table) => ({\n    contractAddressIndex: index('markets_contract_address_idx').on(table.contractAddress),\n    statusIndex: index('markets_status_idx').on(table.status),\n    categoryIndex: index('markets_category_idx').on(table.category),\n    endDateIndex: index('markets_end_date_idx').on(table.endDate),\n    createdAtIndex: index('markets_created_at_idx').on(table.createdAt),\n  })\n);\n\n/**\n * 市場事件表\n * \n * 記錄市場的重要事件（狀態變化、結果、取消等）\n */\nexport const marketEvents = pgTable(\n  'market_events',\n  {\n    // 主鍵\n    id: varchar('id', { length: 36 }).primaryKey(), // UUID\n\n    // 關聯\n    marketId: varchar('market_id', { length: 36 }).notNull(),\n\n    // 事件信息\n    eventType: varchar('event_type', { length: 50 }).notNull(), // 'created', 'opened', 'closed', 'resolved', 'cancelled'\n    eventData: jsonb('event_data'), // 事件詳細數據\n    description: text('description'),\n\n    // 區塊鏈信息\n    transactionHash: varchar('transaction_hash', { length: 66 }),\n    blockNumber: integer('block_number'),\n    blockTimestamp: timestamp('block_timestamp', { withTimezone: true }),\n\n    // 時間戳\n    createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),\n  },\n  (table) => ({\n    marketIdIndex: index('market_events_market_id_idx').on(table.marketId),\n    eventTypeIndex: index('market_events_event_type_idx').on(table.eventType),\n    createdAtIndex: index('market_events_created_at_idx').on(table.createdAt),\n    foreignKeyMarket: foreignKey({\n      columns: [table.marketId],\n      foreignColumns: [markets.id],\n    }).onDelete('cascade'),\n  })\n);\n\n/**\n * 市場價格表\n * \n * 記錄市場價格的歷史變化\n */\nexport const marketPrices = pgTable(\n  'market_prices',\n  {\n    // 主鍵\n    id: varchar('id', { length: 36 }).primaryKey(), // UUID\n\n    // 關聯\n    marketId: varchar('market_id', { length: 36 }).notNull(),\n\n    // 價格信息\n    yesPrice: numeric('yes_price', { precision: 10, scale: 8 }).notNull(), // 0-1\n    noPrice: numeric('no_price', { precision: 10, scale: 8 }).notNull(), // 0-1\n    spread: numeric('spread', { precision: 10, scale: 8 }), // yes_price - no_price\n\n    // 流動性信息\n    totalLiquidity: numeric('total_liquidity', { precision: 38, scale: 18 }).notNull(), // Wei\n    yesLiquidity: numeric('yes_liquidity', { precision: 38, scale: 18 }).notNull(), // Wei\n    noLiquidity: numeric('no_liquidity', { precision: 38, scale: 18 }).notNull(), // Wei\n\n    // 交易量信息\n    volume24h: numeric('volume_24h', { precision: 38, scale: 18 }).default('0'), // Wei\n    trades24h: integer('trades_24h').default(0),\n    uniqueTraders24h: integer('unique_traders_24h').default(0),\n\n    // 時間戳\n    timestamp: timestamp('timestamp', { withTimezone: true }).notNull(),\n    createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),\n  },\n  (table) => ({\n    marketIdIndex: index('market_prices_market_id_idx').on(table.marketId),\n    timestampIndex: index('market_prices_timestamp_idx').on(table.timestamp),\n    marketIdTimestampIndex: uniqueIndex('market_prices_market_id_timestamp_idx').on(\n      table.marketId,\n      table.timestamp\n    ),\n    foreignKeyMarket: foreignKey({\n      columns: [table.marketId],\n      foreignColumns: [markets.id],\n    }).onDelete('cascade'),\n  })\n);\n\n/**\n * 市場流動性表\n * \n * 記錄市場流動性的變化\n */\nexport const marketLiquidity = pgTable(\n  'market_liquidity',\n  {\n    // 主鍵\n    id: varchar('id', { length: 36 }).primaryKey(), // UUID\n\n    // 關聯\n    marketId: varchar('market_id', { length: 36 }).notNull(),\n\n    // 流動性提供者信息\n    providerAddress: varchar('provider_address', { length: 42 }).notNull(),\n\n    // 流動性信息\n    amount: numeric('amount', { precision: 38, scale: 18 }).notNull(), // Wei\n    yesAmount: numeric('yes_amount', { precision: 38, scale: 18 }).notNull(), // Wei\n    noAmount: numeric('no_amount', { precision: 38, scale: 18 }).notNull(), // Wei\n\n    // LP Token 信息\n    lpTokenAmount: numeric('lp_token_amount', { precision: 38, scale: 18 }).notNull(),\n    lpTokenAddress: varchar('lp_token_address', { length: 42 }),\n\n    // 交易信息\n    transactionHash: varchar('transaction_hash', { length: 66 }).notNull(),\n    blockNumber: integer('block_number').notNull(),\n\n    // 狀態\n    status: varchar('status', { length: 20 }).notNull().default('active'), // 'active', 'withdrawn'\n\n    // 時間戳\n    createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),\n    withdrawnAt: timestamp('withdrawn_at', { withTimezone: true }),\n  },\n  (table) => ({\n    marketIdIndex: index('market_liquidity_market_id_idx').on(table.marketId),\n    providerAddressIndex: index('market_liquidity_provider_address_idx').on(table.providerAddress),\n    statusIndex: index('market_liquidity_status_idx').on(table.status),\n    foreignKeyMarket: foreignKey({\n      columns: [table.marketId],\n      foreignColumns: [markets.id],\n    }).onDelete('cascade'),\n  })\n);\n\n/**\n * 市場統計表\n * \n * 存儲市場的聚合統計數據\n */\nexport const marketStats = pgTable(\n  'market_stats',\n  {\n    // 主鍵\n    id: varchar('id', { length: 36 }).primaryKey(), // UUID\n\n    // 關聯\n    marketId: varchar('market_id', { length: 36 }).notNull().unique(),\n\n    // 統計信息\n    totalVolume: numeric('total_volume', { precision: 38, scale: 18 }).default('0'), // Wei\n    totalTrades: integer('total_trades').default(0),\n    uniqueTraders: integer('unique_traders').default(0),\n    averageTradeSize: numeric('average_trade_size', { precision: 38, scale: 18 }).default('0'), // Wei\n\n    // 價格統計\n    highPrice: numeric('high_price', { precision: 10, scale: 8 }).default('1'),\n    lowPrice: numeric('low_price', { precision: 10, scale: 8 }).default('0'),\n    currentPrice: numeric('current_price', { precision: 10, scale: 8 }).default('0.5'),\n    priceChange24h: numeric('price_change_24h', { precision: 10, scale: 8 }).default('0'),\n\n    // 流動性統計\n    averageLiquidity: numeric('average_liquidity', { precision: 38, scale: 18 }).default('0'), // Wei\n    maxLiquidity: numeric('max_liquidity', { precision: 38, scale: 18 }).default('0'), // Wei\n    minLiquidity: numeric('min_liquidity', { precision: 38, scale: 18 }).default('0'), // Wei\n\n    // 參與者統計\n    totalParticipants: integer('total_participants').default(0),\n    yesParticipants: integer('yes_participants').default(0),\n    noParticipants: integer('no_participants').default(0),\n\n    // 時間戳\n    lastUpdatedAt: timestamp('last_updated_at', { withTimezone: true }).notNull().defaultNow(),\n    createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),\n  },\n  (table) => ({\n    marketIdIndex: uniqueIndex('market_stats_market_id_idx').on(table.marketId),\n    foreignKeyMarket: foreignKey({\n      columns: [table.marketId],\n      foreignColumns: [markets.id],\n    }).onDelete('cascade'),\n  })\n);\n\n/**\n * 類型定義\n */\nexport type Market = typeof markets.$inferSelect;\nexport type NewMarket = typeof markets.$inferInsert;\n\nexport type MarketEvent = typeof marketEvents.$inferSelect;\nexport type NewMarketEvent = typeof marketEvents.$inferInsert;\n\nexport type MarketPrice = typeof marketPrices.$inferSelect;\nexport type NewMarketPrice = typeof marketPrices.$inferInsert;\n\nexport type MarketLiquidity = typeof marketLiquidity.$inferSelect;\nexport type NewMarketLiquidity = typeof marketLiquidity.$inferInsert;\n\nexport type MarketStats = typeof marketStats.$inferSelect;\nexport type NewMarketStats = typeof marketStats.$inferInsert;\n\n/**\n * 市場狀態枚舉\n */\nexport enum MarketStatus {\n  ACTIVE = 'active',\n  CLOSED = 'closed',\n  RESOLVED = 'resolved',\n  CANCELLED = 'cancelled',\n}\n\n/**\n * 市場事件類型枚舉\n */\nexport enum MarketEventType {\n  CREATED = 'created',\n  OPENED = 'opened',\n  CLOSED = 'closed',\n  RESOLVED = 'resolved',\n  CANCELLED = 'cancelled',\n  PRICE_UPDATED = 'price_updated',\n  LIQUIDITY_ADDED = 'liquidity_added',\n  LIQUIDITY_REMOVED = 'liquidity_removed',\n}\n\n/**\n * 市場分類枚舉\n */\nexport enum MarketCategory {\n  CRYPTO = 'crypto',\n  SPORTS = 'sports',\n  POLITICS = 'politics',\n  WEATHER = 'weather',\n  ENTERTAINMENT = 'entertainment',\n  ECONOMICS = 'economics',\n  TECHNOLOGY = 'technology',\n  OTHER = 'other',\n}\n
